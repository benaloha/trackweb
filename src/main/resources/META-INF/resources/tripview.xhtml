<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<meta content='text/html; charset=UTF-8' http-equiv="Content-Type" />
	<h:outputStylesheet name="style.css" />
</h:head>
<h:body>
	<h:form>
		<p:growl id="msgs" showDetail="true" />

		<h:panelGrid columns="2" cellpadding="5">
			<p:outputLabel for="from" value="From:" />
			<p:calendar id="from" value="#{tripController.from}" />

			<p:outputLabel for="to" value="To:" />
			<p:calendar id="to" value="#{tripController.to}" />
		</h:panelGrid>

		<p:commandButton value="Get Trips" update="tripsTable"
			actionListener="#{tripController.retrieveTrips}"/>

		<p:button id="mapButton" outcome="tripmap" value="Show Map"/>

		<p:dialog modal="true" resizable="false" header="Values"
			widgetVar="dlg" showEffect="fold">
			<p:panelGrid id="display" columns="2" columnClasses="label,value">
				<h:outputText value="From:" />
				<h:outputText value="#{tripController.from}">
					<f:convertDateTime pattern="dd-MM-yyyy" />
				</h:outputText>

				<h:outputText value="To:" />
				<h:outputText value="#{tripController.to}">
					<f:convertDateTime pattern="dd-MM-yyyy" />
				</h:outputText>
			</p:panelGrid>
		</p:dialog>

		<p:dataTable id="tripsTable"
			var="trip"
			value="#{tripSessionBean.trips}"
			rowIndexVar="index" 
			rowKey="#{trip.startTime}"
			selection="#{tripSessionBean.selectedTrip}" 
			selectionMode="single"
			resizableColumns="true"
			scrollable="true"
			scrollHeight="150">
			
			<p:ajax event="rowSelect" listener="#{tripController.onTripRowSelect}" />
			
			<f:facet name="header">Trips
			</f:facet>

			<p:column headerText="Start Time" sortBy="#{trip.startTime}" width="100">
				<h:outputText value="#{trip.startTime}">
					<f:convertDateTime pattern="dd-MM HH:mm" timeZone="Europe/Amsterdam" />
				</h:outputText>
			</p:column>
			<p:column headerText="End Time" sortBy="#{trip.endTime}" width="100">
				<h:outputText value="#{trip.endTime}">
					<f:convertDateTime pattern="dd-MM HH:mm" timeZone="Europe/Amsterdam" />
				</h:outputText>
			</p:column>
			<p:column headerText="Avg. Sp. &lt;br/&gt;[km/h]" sortBy="#{trip.averageSpeed}" width="55">
				<h:outputText value="#{trip.averageSpeed}">
					<f:convertNumber minFractionDigits="1" maxFractionDigits="1" />
				</h:outputText>
			</p:column>
			<p:column headerText="Max. Sp. &lt;br/&gt;[km/h]" sortBy="#{trip.maxSpeed}" width="55">
				<h:outputText value="#{trip.maxSpeed}">
					<f:convertNumber minFractionDigits="1" maxFractionDigits="1" />
				</h:outputText>
			</p:column>
			<p:column headerText="Dist.&lt;br/&gt;[km]" sortBy="#{trip.distance}" width="50" >
				<h:outputText value="#{trip.distance}">
					<f:convertNumber minFractionDigits="1" maxFractionDigits="1" />
				</h:outputText>
			</p:column>
			<p:column headerText="Time" sortBy="#{trip.duration}" width="60">
				<h:outputText value="#{trip.duration.toString().replace('PT','')}">
				</h:outputText>
			</p:column>

			<p:column headerText="Start Address" width="350">
				<h:outputText value="#{trip.startAddress}" />
			</p:column>
			<p:column headerText="End Address" width="350">
				<h:outputText value="#{trip.endAddress}" />
			</p:column>
			
		</p:dataTable>
	</h:form>
</h:body>
</html>